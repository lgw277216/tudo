!function(){function t(t){x.push(t),store.set("task",x)}function e(){h.html(null);for(var t=[],e=0;e<x.length;e++)if(x[e].complate)t[e]=x[e];else{var i=n(e,x[e]);h.prepend(i)}for(var c=0;c<t.length;c++){var l=n(c,t[c]);l&&(h.append(l),l.addClass("unline"))}var o=$(".delete.r-main"),d=$(".task-list .complate");a(o),s(),u(d)}function n(t,e){if(e){var n='<li data-index="'+t+'"><input type="checkbox" '+(e.complate?"checked":"")+' class="complate"><p class="content">'+e.content+'</p><div class="right"><span class="delete r-main">删除</span><span class="deteal r-main">详细</span></div></li>';return $(n)}}function a(t){t.on("click",function(){i($(this).parent().parent().data("index"))})}function i(t){$(".Alert").show(),$(".primary.confirm").bind("click",function(){x.splice(t,1),$(".Alert").hide(),c(),e()}),$(".cancel").click(function(){$(".Alert").hide()})}function c(){store.set("task",x)}function s(){$(".deteal.r-main").on("click",function(){var t=$(this).parent().parent().data("index"),e=l(x[t]);h.after(e),d(t),o(),f(),$(".task-detail-mask,.colse").click(function(){$(".task-detail").remove(),$(".task-detail-mask").remove()})})}function l(t){return'<div class="task-detail-mask"></div><div class="task-detail"><form class="up-task"><h2 class="content">'+t.content+'</h2><div class="input-item"><input type="text" id="dbText" class="dbText"></div><div class="input-item"><textarea>'+(t.dsk||"")+'</textarea></div><div class="remind input-item"><label for="b">提醒时间</label><input id="b" class="datetime" type="text" value="'+(t.time||"")+'"></div><div class="input-item"><button>更新</button></div><div class="colse">X</div></form></div>'}function o(){var t=$(".task-detail .up-task .content");t.dblclick(function(){var e=$("#dbText");t.hide(),e.show(),e.focus(),e.blur(function(){e.hide(),t.show(),e.val()&&t.text(e.val())})})}function d(t){var e=$(".task-detail .up-task");e.on("submit",function(n){n.preventDefault();var a={};a.content=e.find(".content").text(),a.dsk=e.find(".input-item textarea").val(),a.time=e.find(".remind .datetime").val(),r(a,t),m()})}function r(t,n){x[n]=$.extend({},x[n],t),store.set("task",x),e()}function u(t){t.on("click",function(){var t=$(this).parent().data("index");x[t].complate?r({complate:!1},t):r({complate:!0},t)})}function f(){$.datetimepicker.setLocale("ch"),$(".datetime").datetimepicker({yearStart:2016,yearEnd:2018})}function m(){var t=null;t=setInterval(function(){for(var e=(new Date).getTime(),n=0;n<x.length;n++)!x[n].time||x[n].complate||x[n].off||new Date(x[n].time).getTime()-e<1&&(v(x[n].content),r({off:!0},n),clearInterval(t),p())},1e3)}function p(){document.querySelector(".music_yousa").play()}function v(t){$(".msg").show(),$(".msg-content").text(t),$(".msg-konw").on("click",function(){$(".msg").hide()})}var k=$(".add-task"),h=$(".task-list"),x=[];!function(){x=store.get("task")||[],e()}(),k.on("submit",function(n){n.preventDefault();var a={};a.content=k.find(".text").val(),a.content&&(t(a),k.find(".text").val(null),e())}),store.clear()}();